/// (UIX.Configuration.ts is generated by the provided buildtools)
/// <reference path="../UIX.Configuration.ts" />

/// <reference path="Polyfill/Polyfills.ts" />
/// <reference path="Core/Static/Initialization.ts" />
/// <reference path="Localization/Index.ts" />

/// <reference path="Interface/AjaxInterface.ts" />
/// <reference path="Interface/ServiceWorkerInterface.ts" />

/// <reference path="Core/Tools/ClearCache.ts" />
/// <reference path="WidgetSystem/Render.ts" />

/// <reference path="Libraries/FormGenerator/FormFactory.ts" />

namespace UIX{
    if(!Core.Tools.ClearCache.clearCacheIfRequired()){
        const UIX_DEVELOPMENT_MODE = true;

        if(UIX_DEVELOPMENT_MODE){

            let formGenerator = Libraries.FormGenerator.FormFactory.factory.form(factory => [

                factory.form(() => [
                    factory.textInput("firstName", false, undefined, "First Name"),
                    factory.textInput("lastName", false, undefined, "Last Name"),
                    factory.textInput("email", false, undefined, "E-Mail")
                ], "Personal Data"),

                factory.form(() => [
                    factory.textInput("displayName", false, undefined, "Display Name", "This is the name on your profile."),
                    factory.textInput("password", false, "Choose your password", "Password"),
                    factory.textInput("passwordConfirmation", false, "Confirm your password", "Password Confirmation")
                ], "Account Information"),

                factory.textInput("message", true, "Your message here", "Message")

            ]).toFormGenerator();

            document.body.appendChild(formGenerator.getFormElement());
            
            //WidgetSystem.Render.fallback();
        }else{
            let success = false;
            {
                let localStoredWebsite = localStorage.getItem("webpage");
                if(localStoredWebsite){
                    success = WidgetSystem.Render.fromJson(localStoredWebsite);
                }
            }
            if(!success){
                AjaxInterface.get("/Webpage.uix.json").then(response => {
                    if(response && response.wasSuccessfully){
                        success = WidgetSystem.Render.fromResponse(response);
                    }

                    if(!success){
                        AjaxInterface.get("https://uix.yer.tools/Webpage.uix.json").then(fallbackResponse => {
                            if(fallbackResponse && fallbackResponse.wasSuccessfully){
                                success = WidgetSystem.Render.fromResponse(fallbackResponse);
                            }
                            
                            if(!success && !WidgetSystem.Render.redirectToEditMode()){
                                WidgetSystem.Render.fallback();
                            }
                        });
                    }
                });
            }
        }
    }else{
        WidgetSystem.Render.clearingCacheMessage();
    }
}